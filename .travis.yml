language: python
dist: focal

python:
  - "3.8"
  - "3.9"
  - "3.10"
  - "3.11"

install:
  - pip install pip --upgrade
  # poetry1.2.0だと、pillowのインストールで失敗する(https://app.travis-ci.com/github/kurusugawa-computer/annowork-cli/jobs/581658649#L932)ので、poetry1.2.0未満にする
  - pip install "poetry<1.4"
  - travis_retry poetry install

before_script:
  - export TZ=Asia/Tokyo
  - sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
  - echo "Asia/Tokyo" > sudo tee /etc/timezone  > /dev/null

script:
   - make lint
  # webapiにアクセスするテストは実行しないようにする
   - poetry run pytest -n auto -m "not access_webapi"

branches:
  only:
      - main

cache: pip
